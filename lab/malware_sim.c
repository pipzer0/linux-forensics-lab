/*
 * Simulated malware for forensics training
 * This is a HARMLESS training artifact
 * Compiled timestamp will be embedded in ELF
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <pwd.h>

// Simulated C2 beacon - does nothing harmful
#define C2_SERVER "198.51.100.47"
#define C2_PORT 443
#define BEACON_INTERVAL 300

// XOR key for "obfuscation" demo
const char xor_key[] = "s3cr3tk3y";

char* decode_string(const char* encoded, int len) {
    char* decoded = malloc(len + 1);
    for(int i = 0; i < len; i++) {
        decoded[i] = encoded[i] ^ xor_key[i % strlen(xor_key)];
    }
    decoded[len] = '\0';
    return decoded;
}

void collect_info() {
    // Simulated recon - just prints, doesn't exfil
    struct passwd *pw = getpwuid(getuid());
    char hostname[256];
    gethostname(hostname, sizeof(hostname));

    printf("[SIM] Would collect: user=%s, host=%s\n",
           pw ? pw->pw_name : "unknown", hostname);
}

void establish_persistence() {
    // Simulated persistence - prints what it would do
    printf("[SIM] Would create persistence in crontab\n");
    printf("[SIM] Would add SSH key to authorized_keys\n");
}

int main(int argc, char *argv[]) {
    printf("=== FORENSICS TRAINING MALWARE SIMULATOR ===\n");
    printf("This binary is HARMLESS - for training only\n\n");

    // These leave forensic artifacts
    collect_info();
    establish_persistence();

    printf("\n[SIM] Would beacon to %s:%d every %ds\n",
           C2_SERVER, C2_PORT, BEACON_INTERVAL);

    // Create a marker file investigators should find
    FILE *f = fopen("/tmp/.mal_marker", "w");
    if(f) {
        fprintf(f, "beacon_active=true\nc2=%s\n", C2_SERVER);
        fclose(f);
    }

    return 0;
}
